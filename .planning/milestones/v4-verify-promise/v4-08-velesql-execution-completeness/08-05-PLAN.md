# Plan 08-05: E2E Tests & Documentation Update

**Phase:** 8 ‚Äî VelesQL Execution Completeness
**Requirement:** VP-014, VP-015, VP-013 (verification)
**Estimate:** 3-4h
**Depends on:** Plans 08-01 to 08-04

---

## Goal

Validate all new execution paths with end-to-end tests and update documentation to remove "parser only" warnings now that JOIN/UNION/EXPLAIN actually work.

---

## Tasks

### Task 1: E2E Test ‚Äî JOIN Scenarios

**File:** `crates/velesdb-core/tests/e2e_join.rs` (new)

Real-world scenarios:
1. **E-commerce**: `SELECT * FROM products JOIN inventory ON products.sku = inventory.sku WHERE vector NEAR $v LIMIT 10` ‚Äî vector search + JOIN with structured data
2. **RAG with metadata**: `SELECT * FROM documents LEFT JOIN authors ON documents.author_id = authors.id WHERE similarity(embedding, $v) > 0.7`
3. **Chained JOIN**: Two sequential JOINs
4. **JOIN + ORDER BY + LIMIT**: Full pipeline
5. **JOIN table not found**: Error handling

### Task 2: E2E Test ‚Äî Compound Query Scenarios

**File:** `crates/velesdb-core/tests/e2e_compound.rs` (new)

1. **UNION**: `SELECT * FROM active_docs WHERE category = 'tech' UNION SELECT * FROM archived_docs WHERE category = 'tech'`
2. **UNION ALL**: Same query, keeps duplicates
3. **INTERSECT**: Find documents in both collections
4. **EXCEPT**: Find documents only in first collection
5. **Same-collection UNION with different WHERE**: `SELECT * FROM docs WHERE tag = 'a' UNION SELECT * FROM docs WHERE tag = 'b'`

### Task 3: E2E Test ‚Äî EXPLAIN Endpoint

**File:** `crates/velesdb-server/tests/explain_e2e.rs` (new, if server tests exist)

Or add to existing server integration tests:
1. `POST /query/explain` with basic SELECT ‚Üí 200 + plan
2. `POST /query/explain` with JOIN ‚Üí plan includes JOIN step
3. `POST /query/explain` with invalid SQL ‚Üí 400 + error
4. `POST /query/explain` with unknown collection ‚Üí 404

### Task 4: Update VELESQL_SPEC.md ‚Äî Remove Parser-Only Warnings

**File:** `docs/VELESQL_SPEC.md`

- Remove `‚ö†Ô∏è **Parser only**` warning from JOIN section
- Remove `‚ö†Ô∏è **Parser only**` warning from Set Operations section
- Update feature support table: JOIN ‚Üí `‚úÖ Stable`, Set Operations ‚Üí `‚úÖ Stable`
- Add execution notes (INNER + LEFT supported, RIGHT/FULL planned)

### Task 5: Update README.md ‚Äî Remove Parser-Only Labels

**File:** `README.md`

- Change `üß™ JOIN ‚Äî parser support (execution planned)` ‚Üí `‚úÖ JOIN (INNER, LEFT) across collections`
- Change `üß™ UNION / INTERSECT / EXCEPT ‚Äî parser support (execution planned)` ‚Üí `‚úÖ UNION / INTERSECT / EXCEPT set operations`
- Update roadmap EPIC-021 description
- Add `/query/explain` to API table

### Task 6: Update GAPS.md ‚Äî Close Resolved Gaps

**File:** `.planning/phases/v4-05-readme-documentation-truth/GAPS.md`

Mark JOIN, UNION, and EXPLAIN gaps as **RESOLVED** with commit references.

### Task 7: Quality Gates

```powershell
cargo fmt --all --check
cargo clippy -- -D warnings
cargo test --workspace
cargo deny check
cargo build --release
```

---

## Acceptance Criteria

- [ ] 10+ E2E tests covering JOIN, compound queries, and EXPLAIN
- [ ] All E2E tests pass
- [ ] VELESQL_SPEC.md has no parser-only warnings for JOIN/Set Ops
- [ ] README.md has no parser-only labels for JOIN/Set Ops
- [ ] `/query/explain` documented in README API table
- [ ] GAPS.md updated with resolution status
- [ ] All quality gates pass

---

## Files

| File | Action |
|------|--------|
| `tests/e2e_join.rs` | **New** ‚Äî E2E JOIN tests |
| `tests/e2e_compound.rs` | **New** ‚Äî E2E compound query tests |
| `docs/VELESQL_SPEC.md` | **Modify** ‚Äî remove parser-only warnings |
| `README.md` | **Modify** ‚Äî update feature labels |
| `.planning/phases/v4-05-*/GAPS.md` | **Modify** ‚Äî mark gaps resolved |

---
*Created: 2026-02-09*
