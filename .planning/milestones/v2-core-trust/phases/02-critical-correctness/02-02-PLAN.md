---
phase: 2
plan: 2
name: GPU Trigram Cleanup
wave: 1
depends_on: none
autonomous: true
---

# Phase 2 Plan 2: GPU Trigram Cleanup

## Objective

Remove the misleadingly-named `GpuTrigramAccelerator` which performs zero GPU operations. Replace with honestly-named `TrigramAccelerator` (CPU). No lying struct names in production code.

## Context

**Requirements addressed:** C-02
**Phase goal contribution:** Eliminates a struct that claims GPU acceleration but uses CPU — prevents users from believing they have GPU trigram search.

**Current state:**
- `crates/velesdb-core/src/index/trigram/gpu.rs` — `GpuTrigramAccelerator` wraps `GpuAccelerator` but only uses it for... nothing useful. All trigram operations (`batch_extract_trigrams`, `batch_search`) are pure CPU `HashMap` lookups.

## Tasks

### Task 1: Rename GpuTrigramAccelerator → TrigramAccelerator

**Files:**
- `crates/velesdb-core/src/index/trigram/gpu.rs`
- `crates/velesdb-core/src/index/trigram/mod.rs`

**Action:**
1. Rename `GpuTrigramAccelerator` → `TrigramAccelerator` in `gpu.rs`
2. Remove the `accelerator: GpuAccelerator` field — it's unused for actual trigram operations
3. Rename file `gpu.rs` → `accelerator.rs` (it's not GPU anymore)
4. Update `mod.rs` to reflect new module name and re-export
5. Update all test references

**Verify:**
```powershell
# No more references to GpuTrigramAccelerator
Select-String -Path "crates/velesdb-core/src/**/*.rs" -Pattern "GpuTrigramAccelerator" -Recurse
# Should find zero matches

cargo test --package velesdb-core --features gpu -- trigram
```

**Done when:**
- Zero occurrences of `GpuTrigramAccelerator` in codebase
- `TrigramAccelerator` works identically (pure CPU)
- No `GpuAccelerator` dependency in trigram module
- All trigram tests pass

---

### Task 2: Update public API exports

**Files:**
- `crates/velesdb-core/src/index/trigram/mod.rs`
- Any file importing `GpuTrigramAccelerator`

**Action:**
1. Search entire codebase for `GpuTrigramAccelerator` imports
2. Update to `TrigramAccelerator`
3. If the struct was `pub` in `lib.rs` or `mod.rs` re-exports, update those too

**Verify:**
```powershell
cargo check --workspace --features persistence,gpu,update-check --exclude velesdb-python
cargo clippy --workspace --features persistence,gpu,update-check --exclude velesdb-python -- -D warnings
```

**Done when:**
- `cargo check` passes with zero errors
- No broken imports anywhere in workspace

---

## Verification

After all tasks complete:

```powershell
# Full test suite
cargo test --workspace --features persistence,gpu,update-check --exclude velesdb-python

# Quality gates
cargo fmt --all --check
cargo clippy --workspace --features persistence,gpu,update-check --exclude velesdb-python -- -D warnings
```

## Success Criteria

- [ ] `GpuTrigramAccelerator` deleted from codebase
- [ ] `TrigramAccelerator` exists with identical CPU functionality
- [ ] File renamed from `gpu.rs` to `accelerator.rs`
- [ ] No `GpuAccelerator` dependency in trigram module
- [ ] All trigram tests pass
- [ ] Clippy clean

## Output

**Files modified:**
- `crates/velesdb-core/src/index/trigram/gpu.rs` → renamed to `accelerator.rs`, struct renamed
- `crates/velesdb-core/src/index/trigram/mod.rs` — updated module reference + re-export
