---
phase: v3-03
plan: 06
name: Test Coverage Sweep & Integration Patterns
wave: 3
depends_on: ["v3-03-04"]
autonomous: true
parallel_safe: true
estimated_time: 20min
---

# Phase v3-03 Plan 06: Test Coverage Sweep & Integration Patterns

## Objective

Fill test coverage gaps across the SDK: verify every `IVelesDBBackend` method has at least one test, add edge case tests for error paths, validate WasmBackend stubs for new methods, and add integration test patterns for common usage workflows.

## Context

**Requirements addressed:** Quality — TDD coverage for all public API surface
**Phase goal contribution:** Ensures production readiness and prevents regressions.

Current test files (6):
- `client.test.ts` — VelesDB client validation and delegation
- `rest-backend.test.ts` — REST backend mock-based tests
- `wasm-backend.test.ts` — WASM backend tests
- `query-builder.test.ts` — VelesQLBuilder MATCH tests
- `types.test.ts` — Type validation tests
- `velesql-v2.test.ts` — VelesQL v2 syntax tests

**Gaps to fill:**
- `explain()` in WasmBackend (throws NOT_SUPPORTED) — needs test
- `explain()` in client.ts — needs validation test
- Error paths for new methods (explain with bad query, search with invalid mode)
- Edge cases: empty responses, null payloads, large IDs (bigint)
- Integration patterns: typical RAG workflow, graph + vector hybrid

## Tasks

### Task 1: WasmBackend stub coverage

**Files:** `sdks/typescript/tests/wasm-backend.test.ts`
**Action:**
Add tests for every NOT_SUPPORTED method stub:
- `explain()` throws VelesDBError with code 'NOT_SUPPORTED'
- Verify all existing stubs still throw correctly: `textSearch`, `hybridSearch`, `query`, `multiQuerySearch`, `matchQuery`, `addEdge`, `getEdges`, `traverseGraph`, `getNodeDegree`
- One test per stub, consistent error message format

**Verify:** `npx vitest run tests/wasm-backend.test.ts`
**Done when:** Every NOT_SUPPORTED stub has a test, all pass

---

### Task 2: Client validation coverage

**Files:** `sdks/typescript/tests/client.test.ts`
**Action:**
Add tests for new client methods:
- `explain()` with empty query → throws ValidationError
- `explain()` with valid query → delegates to backend
- Verify `matchQuery()` validation (non-empty collection, non-empty query)
- Verify init-guard: calling any method before `init()` throws

**Verify:** `npx vitest run tests/client.test.ts`
**Done when:** All new client methods have validation tests

---

### Task 3: REST backend edge cases

**Files:** `sdks/typescript/tests/rest-backend.test.ts`
**Action:**
Add edge case tests:
- `search()` with empty results → returns `[]`
- `listCollections()` with empty response → returns `[]`
- `query()` with server error → throws VelesDBError with correct code
- `matchQuery()` with 404 → throws NotFoundError
- `getPoint()` with non-existent ID → returns `null`
- `delete()` on non-existent point → returns `true` (server returns 200)
- `traverseGraph()` with empty results → returns `{ results: [], hasMore: false, stats: { visited: 0, depthReached: 0 } }`
- `explain()` with parse error → throws VelesDBError
- Large numeric ID handling: parseNodeId with value > MAX_SAFE_INTEGER

**Verify:** `npx vitest run tests/rest-backend.test.ts`
**Done when:** 9+ new edge case tests pass

---

### Task 4: Full verification + coverage report

**Action:**
- Run complete test suite across all test files
- Verify zero type errors
- Ensure test count increased by 15+ from baseline

**Verify:**
```powershell
cd sdks/typescript
npx tsc --noEmit
npx vitest run --reporter=verbose
```
**Done when:** All tests pass, total test count ≥ baseline + 15

## Verification

```powershell
cd sdks/typescript
npx tsc --noEmit && npx vitest run --reporter=verbose
```

## Success Criteria

- [ ] Every `IVelesDBBackend` method has at least one test
- [ ] Every WasmBackend NOT_SUPPORTED stub has a test
- [ ] Client validation tested for all new methods
- [ ] Edge cases: empty responses, null payloads, error paths
- [ ] Large ID (bigint) handling tested
- [ ] 15+ new tests added
- [ ] All tests pass, zero type errors

## Parallel Safety

**Exclusive write files:**
- `sdks/typescript/tests/wasm-backend.test.ts` (add tests)
- `sdks/typescript/tests/client.test.ts` (add tests)
- `sdks/typescript/tests/rest-backend.test.ts` (add tests)
**Shared read files:** `sdks/typescript/src/types.ts`, `sdks/typescript/src/backends/rest/`, `sdks/typescript/src/client.ts`
**Conflicts with:** none — test files are exclusive to this plan

## Output

**Files modified:**
- `sdks/typescript/tests/wasm-backend.test.ts` — NOT_SUPPORTED stub tests
- `sdks/typescript/tests/client.test.ts` — New method validation tests
- `sdks/typescript/tests/rest-backend.test.ts` — Edge case + error path tests
