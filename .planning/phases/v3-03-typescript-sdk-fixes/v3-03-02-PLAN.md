---
phase: v3-03
plan: 02
title: Types Export, Backend Interface & VelesQLBuilder MATCH
estimated_time: 30min
findings: T-03 (partial), BEG-07 (types cleanup)
---

# Phase v3-03 Plan 02: Types Export, Backend Interface & VelesQLBuilder MATCH

## Objective

Move MATCH types from local `rest.ts` definitions to shared `types.ts` exports, add `matchQuery()` to the `IVelesDBBackend` interface and `VelesDB` client, and enhance `VelesQLBuilder` with a `similarity()` convenience method for MATCH+vector patterns.

## Context

Plan 01 defined MATCH types locally in `rest.ts` to avoid conflicts. Now Plan 02 owns `types.ts` exports and can properly integrate them. The `IVelesDBBackend` interface and `VelesDB` client currently lack `matchQuery()`, meaning it's only accessible via direct `RestBackend` usage.

## Tasks

### Task 1: Move MATCH public types to types.ts

**Files:** `sdks/typescript/src/types.ts`, `sdks/typescript/src/backends/rest.ts`
**Action:**
- Move `MatchQueryOptions`, `MatchQueryResultItem`, `MatchQueryResponse` from `rest.ts` to `types.ts`
- Keep `ServerMatchQueryResponse`, `ServerSelectQueryResponse`, `ServerAggregationResponse` as internal interfaces in `rest.ts`
- Update `rest.ts` imports to reference types from `../types`
**Verify:** `npx tsc --noEmit` — zero errors
**Done:** Types are in `types.ts`, `rest.ts` imports them

### Task 2: Add matchQuery() to IVelesDBBackend and VelesDB client

**Files:** `sdks/typescript/src/types.ts`, `sdks/typescript/src/client.ts`
**Action:**
- Add `matchQuery()` method signature to `IVelesDBBackend` interface
- Add `matchQuery()` to `VelesDB` client with proper validation and JSDoc
- WasmBackend: add stub that throws "not supported" (WASM has no server endpoint)
**Verify:** `npx tsc --noEmit` — zero errors
**Done:** `matchQuery()` available on `VelesDB` client and `IVelesDBBackend`

### Task 3: Add similarity() convenience to VelesQLBuilder + tests

**Files:** `sdks/typescript/src/query-builder.ts`, `sdks/typescript/tests/query-builder.test.ts`
**Action:**
- Add `similarity(alias, paramName, vector, options?)` method that generates `WHERE similarity({alias}.embedding, ${paramName}) > {threshold}`
- Add `orderBySimilarity(direction?)` shorthand for `ORDER BY similarity() DESC`
- Write TDD tests first, then implement
**Verify:** `npx vitest run tests/query-builder.test.ts`
**Done:** New methods work and tests pass

### Task 4: Update index.ts exports

**Files:** `sdks/typescript/src/index.ts`
**Action:**
- Export `MatchQueryOptions`, `MatchQueryResultItem`, `MatchQueryResponse` from types
- These are already auto-exported via `export * from './types'` — verify they appear in build
**Verify:** `npx tsc --noEmit`
**Done:** MATCH types accessible from package root

### Task 5: Full verification

**Action:** Run complete test suite
**Verify:** `npx tsc --noEmit && npx vitest run`
**Done:** Zero type errors, all tests pass

## Success Criteria

- [ ] MATCH types exported from `types.ts` (not local to `rest.ts`)
- [ ] `matchQuery()` in `IVelesDBBackend` interface
- [ ] `matchQuery()` accessible via `VelesDB` client
- [ ] VelesQLBuilder has `similarity()` and `orderBySimilarity()` methods
- [ ] All existing tests still pass
- [ ] New tests for VelesQLBuilder additions
