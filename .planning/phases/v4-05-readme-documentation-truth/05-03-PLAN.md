---
phase: 5
plan: 3
name: README Query & Scenario Accuracy
wave: 2
depends_on: ["05-02"]
autonomous: true
parallel_safe: false
---

# Phase 5 Plan 03: README Query & Scenario Accuracy

## Objective

Cross-reference every SQL query example and code snippet in README.md against Phase 4 test results. Fix syntax errors, add accuracy notes for features with known limitations, and ensure API code examples match the actual public API.

## Context

**Requirements addressed:** VP-008 (README accuracy audit)
**Phase goal contribution:** Users who copy-paste README examples must get working code ‚Äî this is the core promise of the v4-verify-promise milestone.

**‚ö†Ô∏è Post-Phase 8 revision (2026-02-09):**
- Phase 8 Plan 08-05 already removed üß™ parser-only labels from README for JOIN/UNION/INTERSECT/EXCEPT
- Phase 8 added `/query/explain` to README API table
- JOIN (INNER + LEFT) now fully executed ‚Äî no longer a caveat in scenarios
- UNION/INTERSECT/EXCEPT now fully executed
- GAPS.md GAP-1/2/3 already marked RESOLVED
- Line numbers may have shifted due to Phase 8 edits
- **Remaining GAPs:** GAP-4 (GraphService in-memory), GAP-5 (perf conflicts), GAP-6 (business scenario limitations), GAP-7 (API table incomplete), GAP-8 (ecosystem claims), GAP-9 (test counts)

**Known issues identified during audit:**

| Issue | Location | Fix |
|-------|----------|-----|
| Manufacturing MATCH syntax: `[HAS_DEFECT]` missing `:` | ~Line 1209 | Fix to `[:HAS_DEFECT]` |
| Rust API example `db.search(query_vector, filters, graph_traversal)` | ~Line 1157-1159 | Replace with actual API or mark as pseudocode |
| Business scenarios use subqueries ‚Äî now working (Phase 2) | ~Lines 632-718 | Verify match with Phase 4 tests |
| ~~JOIN/compound parse-only labels~~ | N/A | ‚úÖ Already fixed by Phase 8 Plan 08-05 |
| Quantization API: `QuantizedVector::from_f32`, `dot_product_quantized_simd` | ~Lines 1094-1102 | Verify these APIs exist |
| Hero query | Tested in Phase 4 ‚úÖ | Confirm no changes needed |
| Scenario 0 subquery | Tested in Phase 4 ‚úÖ | Confirm no changes needed |
| GAP-7: Missing API endpoints in table | README API section | Add `/empty`, `/flush`, `/search/text`, `/search/hybrid`, `/match` |

**Phase 4 test files to cross-reference:**
- `tests/readme_scenarios/hero_query.rs` ‚Äî Hero query (3 tests)
- `tests/readme_scenarios/select_domain.rs` ‚Äî Medical, E-commerce, Cybersecurity (SELECT scenarios)
- `tests/readme_scenarios/metrics_and_fusion.rs` ‚Äî Distance metrics, NEAR_FUSED
- `tests/readme_scenarios/match_simple.rs` ‚Äî Business scenarios 1-2
- `tests/readme_scenarios/match_complex.rs` ‚Äî Business scenarios 3-4
- `tests/readme_scenarios/cross_store.rs` ‚Äî Scenario 0, VelesQL API

**Phase 8 test files (new ‚Äî JOIN/compound):**
- `tests/e2e_join.rs` ‚Äî 6 E2E JOIN tests (e-commerce, RAG, chained, ORDER BY+LIMIT)
- `tests/e2e_compound.rs` ‚Äî 5 E2E compound query tests (UNION, INTERSECT, EXCEPT)

## Tasks

### Task 1: Cross-Reference README Queries with Phase 4 Tests

**Files:** `README.md`, `crates/velesdb-core/tests/readme_scenarios/*.rs` (read-only)

**Action:**
For each query example in README, verify it has a corresponding Phase 4 test:

1. **Hero query** (line 163-170): Check `hero_query.rs` ‚Üí should match exactly
2. **Business Scenario 1** (lines 632-643): Check `match_simple.rs` ‚Üí verify subquery pattern tested
3. **Business Scenario 2** (lines 658-668): Check `match_simple.rs` ‚Üí verify multi-hop `*1..3` tested
4. **Business Scenario 3** (lines 683-693): Check `match_complex.rs` ‚Üí verify multi-relationship + AVG tested
5. **Business Scenario 4** (lines 708-718): Check `match_complex.rs` ‚Üí verify temporal + ORDER BY tested
6. **Scenario 0** (lines 733-743): Check `cross_store.rs` ‚Üí verify cross-store query tested
7. **Scenario 0b** (lines 773-813): Check `metrics_and_fusion.rs` ‚Üí verify NEAR_FUSED tested
8. **Scenario 0c** (lines 828-933): Check `metrics_and_fusion.rs` ‚Üí verify all 5 metrics tested
9. **Scenario 1 Medical** (lines 942-951): Check `select_domain.rs` ‚Üí verify LIKE + date filter tested
10. **Scenario 2 E-commerce** (lines 981-989): Check `select_domain.rs` ‚Üí verify BETWEEN + multi ORDER BY tested
11. **Scenario 3 Cybersecurity** (lines 1020-1029): Check `select_domain.rs` ‚Üí verify temporal + comparison tested

For any query NOT covered by Phase 4 tests, note it as a gap.

**Verify:**
```powershell
# Count test functions in each file
Get-ChildItem "crates/velesdb-core/tests/readme_scenarios/*.rs" | ForEach-Object {
    $count = (Select-String -Path $_.FullName -Pattern "#\[test\]").Count
    "$($_.Name): $count tests"
}
```

**Done when:**
- Every README query has been mapped to a Phase 4 test
- Any gaps are documented
- No README query contradicts what the tests prove works

---

### Task 2: Fix Syntax Errors and Incorrect Code Examples

**Files:** `README.md`

**Action:**
Fix all identified code issues:

1. **Manufacturing MATCH syntax** (line 1209):
   ```sql
   -- ‚ùå Current (wrong):
   MATCH (part)-[HAS_DEFECT]->(defect)
   -- ‚úÖ Fix to:
   MATCH (part)-[:HAS_DEFECT]->(defect)
   ```

2. **Rust API pseudocode** (lines 1157-1159):
   ```rust
   // ‚ùå Current (doesn't exist):
   let results = db.search(query_vector, filters, graph_traversal);
   ```
   Either:
   - Replace with actual velesdb-core API example, or
   - Mark clearly as pseudocode: `// Pseudocode ‚Äî see API docs for actual syntax`

3. **Quantization API** (lines 1094-1102): Verify these imports/calls exist:
   - `velesdb_core::quantization::QuantizedVector`
   - `QuantizedVector::from_f32()`
   - `dot_product_quantized_simd()`
   If they don't match current API, update to match.

4. **VelesQL query examples** in API Reference section (lines 483-493): Verify syntax matches parser tests

5. **NEAR_FUSED syntax** in Scenario 0b: Verify the `USING FUSION 'rrf' (k=60)` syntax matches what the parser accepts (Phase 4 tests use this)

**Verify:**
```powershell
# Check for the fixed manufacturing syntax
Select-String -Path "README.md" -Pattern "\[HAS_DEFECT\]" # Should have colon
# Check quantization imports exist
Select-String -Path "crates/velesdb-core/src" -Pattern "QuantizedVector" -Recurse
```

**Done when:**
- Manufacturing MATCH syntax fixed
- Rust API example is accurate or clearly marked as pseudocode
- Quantization example uses real API
- All VelesQL syntax examples are parseable

---

### Task 3: Add Accuracy Notes and "Coming Soon" Labels

**Files:** `README.md`

**Action:**
Add truthful annotations for features that have limitations:

1. **Business scenarios with subqueries**: Add a note explaining that subqueries execute against collections in the same VelesDB instance. Cross-database subqueries are not supported. Example:
   ```markdown
   > **Note:** Subqueries like `(SELECT price FROM inventory WHERE sku = product.sku)` execute as
   > correlated scalar subqueries within VelesDB. The referenced collection must exist in the same instance.
   ```

2. **Variable-length paths `*1..3`**: If there are known limitations beyond what Phase 3 implemented, note them.

3. **Cross-store MATCH+Column**: The Reality table in PROJECT.md showed this as "NOT IMPLEMENTED". If it's now working (Phase 4 tests cover it), no note needed. If partial, add a caveat.

4. ~~**EXPLAIN query plans**: Verify EXPLAIN actually works or add "Coming Soon"~~ ‚Üí ‚úÖ **RESOLVED by Phase 8 Plan 08-04** ‚Äî `/query/explain` is now routed and working. No caveat needed.

5. **Distributed Mode** (~lines 1283, 1361-1363): Already labeled "üìã Planned" ‚Äî verify it says "Planned" not "In Progress".

6. **Table aliases**: VELESQL_SPEC.md says üîú Planned ‚Äî if README uses table aliases in examples, add note or fix examples.

7. **GAP-4 (GraphService in-memory)**: Add "‚ö†Ô∏è Preview ‚Äî in-memory only" label to graph REST endpoints. Data added via `/graph/*` API does NOT persist across server restarts.

8. **GAP-7 (Missing API endpoints)**: Add these working endpoints to README API table:
   - `GET /collections/{name}/empty`
   - `POST /collections/{name}/flush`
   - `POST /collections/{name}/search/text`
   - `POST /collections/{name}/search/hybrid`
   - `POST /collections/{name}/match`

9. **RIGHT/FULL JOIN**: If README mentions RIGHT or FULL JOIN, add note that these parse but return `UnsupportedFeature` error (INNER and LEFT fully supported).

**Verify:**
```powershell
Select-String -Path "README.md" -Pattern "Coming Soon|Note:|Planned|Limitation"
```

**Done when:**
- Features with limitations have clear, honest annotations
- No feature is presented as working when it isn't
- "Coming Soon" / "Planned" labels are accurate
- Users copying business scenario queries know what to expect

---

## Verification

After all tasks complete:

```powershell
# Verify no broken MATCH syntax
Select-String -Path "README.md" -Pattern "\)-\[[A-Z]" # Should use [:TYPE] not [TYPE]

# Verify test coverage mapping is complete
# (Manual review of task 1 output)

# Run quality gates
cargo fmt --all --check
cargo clippy -- -D warnings
```

## Success Criteria

- [ ] Every README query mapped to a Phase 4 or Phase 8 test (or gap documented)
- [ ] Manufacturing MATCH syntax fixed (`[:HAS_DEFECT]`)
- [ ] Rust API example accurate or marked as pseudocode
- [ ] Quantization code example verified against actual API
- [ ] Accuracy notes added for features with limitations
- [ ] "Coming Soon" labels on features that don't work yet
- [ ] GAP-4: Graph REST endpoints labeled as "‚ö†Ô∏è Preview ‚Äî in-memory only"
- [ ] GAP-7: Missing API endpoints added to README table
- [ ] RIGHT/FULL JOIN limitation noted if referenced in README
- [ ] No syntax errors in any SQL/Rust/Python code block

## Parallel Safety

**Exclusive write files:** `README.md` (query examples, business scenarios, code snippets sections)
**Shared read files:** `crates/velesdb-core/tests/readme_scenarios/*.rs`, `crates/velesdb-core/tests/e2e_join.rs`, `crates/velesdb-core/tests/e2e_compound.rs`, `crates/velesdb-core/src/**/*.rs`
**Conflicts with:** Plan 05-04 (also writes README.md ‚Äî must run after 05-03)

## Output

**Files modified:**
- `README.md` ‚Äî Fixed syntax errors, added accuracy notes, verified code examples
